
<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡§™‡•ç‡§∞‡§µ‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‚Äì Theme A (CSV Direct + Pagination)</title>
  <style>
    :root { --brand:#E77019; --accent:#1F3B73; --muted:#666; --text:#222; --bg:#fff; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:"Noto Sans Devanagari","Hind",system-ui,Arial,sans-serif; color:var(--text); background:var(--bg); }
    .wrap { max-width:1100px; margin:0 auto; padding:20px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .nav { display:flex; gap:8px; align-items:center; }
    .btn { border:1px solid var(--accent); background:#f5f8ff; color:var(--accent); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn:disabled { opacity:.5; cursor:default; }
    .status { font-size:12px; color:#555; }

    .page { background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 4px 14px rgba(0,0,0,.06); padding:20px; }
    .header { display:grid; grid-template-columns:80px 1fr 180px; gap:16px; align-items:center; border-bottom:4px solid var(--brand); padding-bottom:12px; }
    .logo { width:80px; height:80px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff, #ffe7d6); border:2px solid var(--brand); display:flex; align-items:center; justify-content:center; font-weight:800; color:#9A3E00; }
    .title h1 { margin:0; font-size:28px; color:var(--accent); }
    .subtitle { margin-top:4px; color:var(--muted); }
    .meta-pill { justify-self:end; border:1px solid var(--brand); color:#9A3E00; padding:6px 10px; border-radius:999px; font-size:13px; font-weight:600; background:#fff7ef; }

    .content { display:grid; grid-template-columns:1.1fr 1fr; gap:24px; margin-top:18px; }
    .card { background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 4px 14px rgba(0,0,0,.06); padding:16px; }
    .section-title { margin:0 0 8px; font-size:18px; color:var(--accent); border-left:6px solid var(--brand); padding-left:8px; }
    dl { margin:0; display:grid; grid-template-columns:160px 1fr; row-gap:8px; }
    dt { color:var(--muted); }
    dd { margin:0; }
    .bullets { margin:0; padding-left:18px; }
    .description { margin-top:8px; line-height:1.55; }
    .tag { display:inline-block; background:#fff4ea; color:#9a3e00; border:1px solid #ffd8b5; padding:2px 8px; border-radius:999px; font-size:12px; margin-right:6px; }

    .gallery { display:grid; grid-template-columns:repeat(2, 1fr); gap:10px; }
    .thumb { position:relative; border-radius:12px; overflow:hidden; border:1px solid #eee; background:#fafafa; }
    .thumb img { width:100%; height:180px; object-fit:cover; display:block; }
    .badge-fail { position:absolute; top:6px; left:6px; background:#b91c1c; color:#fff; font-size:10px; padding:2px 6px; border-radius:999px; display:none; }
    .open-original { position:absolute; bottom:6px; left:8px; background:rgba(31,59,115,.95); color:#fff; font-size:11px; padding:3px 8px; border-radius:999px; text-decoration:none; }
    .watch { position:absolute; bottom:6px; right:8px; background:rgba(231,112,25,.95); color:#fff; font-size:12px; padding:3px 8px; border-radius:999px; }

    .lightbox { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.75); z-index:999; }
    .lightbox.open { display:flex; }
    .lightbox img { max-width:92vw; max-height:90vh; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,.35); }
    .lightbox .close { position:absolute; top:16px; right:16px; font-size:26px; color:#fff; cursor:pointer; background:rgba(0,0,0,.5); padding:4px 10px; border-radius:999px; }

    @media print {
      .topbar { display:none; }
      .wrap { padding:0; }
      .page { border:none; box-shadow:none; border-radius:0; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="nav">
        <button class="btn" id="prev">‚óÄÔ∏é ‡§™‡§ø‡§õ‡§≤‡§æ</button>
        <button class="btn" id="next">‡§Ö‡§ó‡§≤‡§æ ‚ñ∂Ô∏é</button>
      </div>
      <div class="nav">
        <button class="btn" onclick="window.print()">PDF ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
        <span class="status" id="status">‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶</span>
      </div>
    </div>

    <div id="page" class="page" aria-live="polite"></div>
  </div>

  <div id="lightbox" class="lightbox" onclick="this.classList.remove('open')">
    <div class="close">√ó ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</div>
    <img id="lightbox-img" src="" alt="full">
  </div>

<script>
  // üëâ ‡§Ø‡§π‡§æ‡§Ç ‡§Ö‡§™‡§®‡§æ Published CSV ‡§≤‡§ø‡§Ç‡§ï ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR4o78Xk4MGw48WSeBe5pmHyqWaJl3lPz18LcA0QCPZmpiNNmkHbJBJS_iX1s63JvhqbOFCrQEMRNeE/pub?output=csv";

  const MAX_PHOTOS = 4;

  const H = {
    ts: "Timestamp",
    date: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï",
    place: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•ç‡§•‡§æ‡§®",
    title: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
    attendance: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§≤ ‡§â‡§™‡§∏‡•ç‡§§‡§ø‡§•‡§ø",
    guests: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§Ö‡§§‡§ø‡§•‡§ø , ‡§ú‡§®‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø",
    photos: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡•á ‡§´‡•ã‡§ü‡•ã",
    info: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•á ‡§∏‡§Æ‡•ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§Ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§Æ‡•á‡§Ç",
    mandal: "‡§Æ‡§Ç‡§°‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
    type: "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞"
  };

  const statusEl = document.getElementById('status');
  const pageEl = document.getElementById('page');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');

  let rows = [];
  let idx = 0;

  function extractFileId(url) {
    if (!url) return "";
    url = url.trim().replace(/^["']|["']$/g,"");
    let m = url.match(/[?&]id=([A-Za-z0-9_\-]+)/);
    if (m && m[1]) return m[1];
    m = url.match(/\/file\/d\/([A-Za-z0-9_\-]+)/);
    if (m && m[1]) return m[1];
    m = url.match(/thumbnail\?id=([A-Za-z0-9_\-]+)/);
    if (m && m[1]) return m[1];
    m = url.match(/uc\?export=view&id=([A-Za-z0-9_\-]+)/);
    if (m && m[1]) return m[1];
    if (/^[A-Za-z0-9_-]{15,}$/.test(url)) return url;
    return "";
  }
  function candidates(url) {
    const id = extractFileId(url);
    if (!id) return [];
    return [
      "https://drive.google.com/uc?export=view&id=" + id,
      "https://drive.google.com/thumbnail?id=" + id + "&sz=w1200",
      "https://lh3.googleusercontent.com/d/" + id + "=w1200",
      "https://drive.google.com/uc?export=download&id=" + id
    ];
  }
  function mkThumb(url) {
    const div = document.createElement("div"); div.className = "thumb";
    const badge = document.createElement("div"); badge.className = "badge-fail"; badge.textContent = "!"; div.appendChild(badge);

    const tries = candidates(url);
    const img = document.createElement("img"); let i = 0; img.src = tries[i] || "";
    img.onerror = () => { i++; if (i < tries.length) img.src = tries[i]; else badge.style.display = "inline-block"; };

    const a = document.createElement("a"); a.className = "open-original"; a.href = tries[0] || url; a.target = "_blank"; a.textContent = "Open original";
    const watch = document.createElement("div"); watch.className = "watch"; watch.textContent = "‡§¶‡•á‡§ñ‡•á‡§Ç";

    img.onclick = (e) => { e.stopPropagation(); const lb = document.getElementById('lightbox'); const lbImg = document.getElementById('lightbox-img'); lbImg.src = img.currentSrc || img.src; lb.classList.add('open'); };

    div.appendChild(img); div.appendChild(a); div.appendChild(watch);
    return div;
  }

  function toPhotos(field) {
    if (!field) return [];
    return field.split(/[\n,]/).map(s=>s.trim()).filter(Boolean).slice(0, MAX_PHOTOS);
  }

  function escapeHtml(s) { return (s||"").toString().replace(/[&<>"']/g, t => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"})[t]); }

  function renderOne(r) {
    const rawPhotos = toPhotos(r[H.photos]);
    const guests = (r[H.guests]||"").split(",").map(s=>s.trim()).filter(Boolean);

    pageEl.innerHTML = `
      <div class="header">
        <div class="logo">BJ</div>
        <div class="title">
          <h1>‡§Æ‡§æ‡§®‡§®‡•Ä‡§Ø ‡§ú‡§ø‡§≤‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑ ‡§ú‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</h1>
          <div class="subtitle">${escapeHtml(r[H.title]||"")} ‚Ä¢ ${escapeHtml(r[H.place]||"")}</div>
        </div>
        <div class="meta-pill">‡§è‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‚Ä¢ ‡§è‡§ï ‡§™‡•á‡§ú</div>
      </div>

      <div class="content">
        <div class="card">
          <h2 class="section-title">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£</h2>
          <dl>
            <dt>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</dt><dd><strong>${escapeHtml(r[H.title]||"")}</strong></dd>
            <dt>‡§§‡§æ‡§∞‡•Ä‡§ñ</dt><dd>${escapeHtml(r[H.date]||"")}</dd>
            <dt>‡§∏‡•ç‡§•‡§æ‡§®</dt><dd>${escapeHtml(r[H.place]||"")}</dd>
            <dt>‡§Æ‡§Ç‡§°‡§≤</dt><dd>${escapeHtml(r[H.mandal]||"")}</dd>
            <dt>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</dt><dd><span class="tag">${escapeHtml(r[H.type]||"")}</span></dd>
            <dt>‡§ï‡•Å‡§≤ ‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø</dt><dd>${escapeHtml(r[H.attendance]||"")}</dd>
            <dt>‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§Ö‡§§‡§ø‡§•‡§ø</dt>
            <dd><ul class="bullets">${guests.map(g=>`<li>${escapeHtml(g)}</li>`).join("") || "<li>‚Äî</li>"}</ul></dd>
          </dl>
          <div class="description">${escapeHtml(r[H.info]||"").replace(/\n/g,"<br>")}</div>
        </div>

        <div class="card">
          <h2 class="section-title">‡§´‡•ã‡§ü‡•ã ‡§ó‡•à‡§≤‡§∞‡•Ä</h2>
          <div class="gallery" id="gal"></div>
        </div>
      </div>

      <div style="margin-top:8px; color:#666; font-size:12px; display:flex; justify-content:space-between;">
        <div>¬© ‡§ú‡§ø‡§≤‡§æ ‡§∏‡§Ç‡§ó‡§†‡§® ‚Ä¢ 30/07/2025</div>
        <div>‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ${idx+1} / ${rows.length}</div>
      </div>
    `;

    const gal = document.getElementById("gal");
    rawPhotos.forEach(u => gal.appendChild(mkThumb(u)));
  }

  function csvToRows(csvText) {
    const rows = [];
    let i = 0, cur = [], cell = "", q = false;
    while (i < csvText.length) {
      const ch = csvText[i];
      if (q) {
        if (ch === '"') {
          if (csvText[i+1] === '"') { cell += '"'; i++; }
          else { q = false; }
        } else cell += ch;
      } else {
        if (ch === '"') q = true;
        else if (ch === ',') { cur.push(cell); cell = ""; }
        else if (ch === '\n') { cur.push(cell); rows.push(cur); cur = []; cell = ""; }
        else if (ch === '\r') { /* skip */ }
        else cell += ch;
      }
      i++;
    }
    if (cell.length || cur.length) { cur.push(cell); rows.push(cur); }
    const header = rows.shift().map(h => h.trim());
    return rows.map(r => { const o = {}; header.forEach((h,j)=>o[h]=r[j]||""); return o; });
  }

  async function loadCsv() {
    statusEl.textContent = "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: CSV ‡§∏‡•á ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶";
    const res = await fetch(CSV_URL, { cache:"no-store" });
    if (!res.ok) throw new Error("CSV fetch failed");
    const text = await res.text();
    rows = csvToRows(text);
    if (!rows.length) throw new Error("Empty CSV");
    idx = 0;
    renderOne(rows[idx]);
    prevBtn.disabled = (idx === 0);
    nextBtn.disabled = (idx >= rows.length - 1);
    statusEl.textContent = "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§§‡•à‡§Ø‡§æ‡§∞";
  }

  prevBtn.addEventListener('click', () => {
    if (idx > 0) idx--;
    renderOne(rows[idx]);
    prevBtn.disabled = (idx === 0);
    nextBtn.disabled = (idx >= rows.length - 1);
  });
  nextBtn.addEventListener('click', () => {
    if (idx < rows.length - 1) idx++;
    renderOne(rows[idx]);
    prevBtn.disabled = (idx === 0);
    nextBtn.disabled = (idx >= rows.length - 1);
  });

  // init
  loadCsv().catch(err => { console.error(err); statusEl.textContent = "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: CSV ‡§≤‡•ã‡§° ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‚Äî ‡§ï‡•É‡§™‡§Ø‡§æ CSV URL ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç"; });
</script>
</body>
</html>
